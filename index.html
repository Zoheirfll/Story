<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Pour Toi ‚ù§Ô∏è</title>

    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚ù§Ô∏è</text></svg>"
    />

    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Montserrat:wght@400;600;800&family=Courier+Prime&family=Orbitron:wght@500&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
      :root {
        --primary: #ff007f;
        --secondary: #70a1ff;
        --glass: rgba(255, 255, 255, 0.9);
        --bg-gradient: linear-gradient(135deg, #fad0c4 0%, #ffd1ff 100%);
        --text: #2d3436;
      }

      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }
      body {
        margin: 0;
        font-family: "Montserrat", sans-serif;
        background: var(--bg-gradient);
        color: var(--text);
        overflow-x: hidden;
        min-height: 100vh;
        padding-bottom: 50px;
      }

      /* CANVAS BACKGROUND */
      #heart-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
      }

      /* CARDS */
      .glass-card {
        background: var(--glass);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 20px;
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        padding: 20px;
        margin: 20px auto;
        max-width: 90%;
        width: 600px;
      }

      /* HEADER */
      header {
        height: 90vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
      }
      h1 {
        font-family: "Dancing Script", cursive;
        font-size: 4rem;
        color: var(--primary);
        text-shadow: 2px 2px 0px white;
        margin: 0;
        animation: bounceInDown 1.5s;
      }

      /* TIMELINE */
      .timeline-item {
        border-left: 3px solid var(--primary);
        padding-left: 20px;
        margin: 30px 0;
        position: relative;
      }
      .timeline-item::before {
        content: "‚ù§Ô∏è";
        position: absolute;
        left: -14px;
        top: 0;
        background: transparent;
      }
      .timeline-img {
        width: 100%;
        border-radius: 10px;
        margin-top: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      /* MAP */
      #map {
        height: 300px;
        width: 100%;
        border-radius: 15px;
        margin-top: 20px;
        border: 4px solid white;
      }

      /* COFFRE FORT (VAULT) */
      #vault-section {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px 0;
      }
      .keypad {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin-top: 20px;
      }
      .key {
        width: 60px;
        height: 60px;
        background: white;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.2rem;
        font-weight: bold;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        transition: 0.1s;
      }
      .key:active {
        background: var(--primary);
        color: white;
        transform: scale(0.9);
      }
      #pin-display {
        background: white;
        width: 180px;
        height: 50px;
        border-radius: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.5rem;
        letter-spacing: 5px;
        border: 2px solid var(--primary);
      }

      /* LOCKED CONTENT */
      #locked-content {
        display: none;
        opacity: 0;
        transition: opacity 1s;
      }
      #locked-content.visible {
        display: block;
        opacity: 1;
      }

      /* AI SCANNER */
      .scanner-circle {
        width: 100px;
        height: 100px;
        border: 4px solid var(--primary);
        border-radius: 50%;
        margin: 20px auto;
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 0 15px var(--primary);
      }
      .scanner-line {
        width: 100%;
        height: 2px;
        background: var(--primary);
        position: absolute;
        animation: scan 1.5s infinite ease-in-out;
        box-shadow: 0 0 10px var(--primary);
      }
      @keyframes scan {
        0% {
          top: 0;
        }
        100% {
          top: 100%;
        }
      }

      /* 2. STYLE GALERIE POLAROID (NOUVEAU) */
      .gallery {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 15px;
        padding: 20px;
      }
      .polaroid {
        background: white;
        padding: 10px 10px 35px 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        transform: rotate(-2deg);
        transition: 0.3s;
        width: 130px;
      }
      .polaroid img {
        width: 100%;
        border-radius: 2px;
      }
      .polaroid:nth-child(even) {
        transform: rotate(3deg);
        margin-top: 10px;
      }
      .polaroid:hover {
        transform: scale(1.2) rotate(0deg) !important;
        z-index: 10;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
      }

      /* TYPEWRITER LETTER */
      .letter-section {
        font-family: "Courier Prime", monospace;
        background: #fff;
        padding: 20px;
        border-radius: 5px;
        transform: rotate(-1deg);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        position: relative;
        margin: 30px auto;
      }
      .letter-section::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 10px;
        background: repeating-linear-gradient(
          45deg,
          #e84393,
          #e84393 10px,
          #fff 10px,
          #fff 20px
        );
      }
      .cursor {
        display: inline-block;
        width: 2px;
        height: 1.2em;
        background-color: black;
        animation: blink 1s infinite;
      }
      @keyframes blink {
        50% {
          opacity: 0;
        }
      }

      /* CHAT SIMULATOR */
      .chat-container {
        background: #fff;
        border-radius: 20px;
        padding: 15px;
        height: 250px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 10px;
        border: 1px solid #eee;
      }
      .msg {
        padding: 8px 12px;
        border-radius: 15px;
        max-width: 80%;
        font-size: 0.9rem;
        animation: fadeIn 0.5s forwards;
      }
      .msg-him {
        background: #dcf8c6;
        align-self: flex-end;
      }
      .msg-her {
        background: #f1f0f0;
        align-self: flex-start;
      }
      .typing {
        font-size: 0.8rem;
        color: #888;
        font-style: italic;
        display: none;
        text-align: right;
      }

      /* GAME TRIGGER BTN */
      .game-trigger {
        background: var(--primary);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 50px;
        font-weight: bold;
        font-size: 1.2rem;
        cursor: pointer;
        display: block;
        margin: 30px auto;
        animation: pulse 2s infinite;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }
      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      /* MODAL GAME */
      .game-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        z-index: 2000;
        justify-content: center;
        align-items: center;
        flex-direction: column;
      }
      .game-content {
        background: white;
        padding: 30px;
        border-radius: 20px;
        width: 90%;
        max-width: 400px;
        text-align: center;
        position: relative;
      }
      .btn-answer {
        width: 100%;
        padding: 15px;
        margin: 8px 0;
        background: #f1f2f6;
        border: 2px solid var(--primary);
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
      }
      .close-game {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 24px;
        cursor: pointer;
      }

      /* SCRATCH CARD */
      #scratch-container {
        position: relative;
        width: 300px;
        height: 150px;
        margin: 20px auto;
        user-select: none;
        display: none;
      }
      #scratch-canvas {
        position: absolute;
        top: 0;
        left: 0;
        border-radius: 10px;
        cursor: crosshair;
      }
      #secret-prize {
        width: 100%;
        height: 100%;
        background: linear-gradient(45deg, #81ecec, #74b9ff);
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: "Dancing Script";
        font-size: 2rem;
        color: white;
        border-radius: 10px;
      }

      /* MUSIC */
      .music-btn {
        position: fixed;
        top: 20px;
        right: 20px;
        background: white;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        cursor: pointer;
        border: 2px solid var(--primary);
      }
      .music-anim {
        animation: spin 4s linear infinite;
      }
      @keyframes spin {
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <canvas id="heart-canvas"></canvas>

    <div class="music-btn" onclick="toggleMusic()" id="music-icon">üéµ</div>
    <audio id="bg-music" loop>
      <source src="music.mp3" type="audio/mpeg" />
    </audio>

    <header>
      <div class="glass-card">
        <p style="letter-spacing: 2px; font-size: 0.8rem">MISSION: VALENTINE</p>
        <h1>Toi & Moi</h1>
        <p
          id="counter"
          style="font-weight: bold; color: var(--primary); margin-top: 15px"
        >
          Chargement...
        </p>
      </div>
      <div
        class="animate__animated animate__bounce animate__infinite"
        style="margin-top: 20px"
      >
        ‚¨áÔ∏è
      </div>
    </header>

    <div class="glass-card">
      <h2 style="color: var(--primary); text-align: center">Notre Histoire</h2>
      <div class="timeline-item">
        <strong>09 Avril 2025</strong><br /><span>Our first Date üí•</span>
        <img
          src="images/screencapture-pastel-diplomatie-gouv-fr-etudesenfrance-dyn-protected-etudiant-ET-PAN-initDossierFormations-html-2026-01-23-12_26_47.png"
          class="timeline-img"
        />
      </div>
      <div class="timeline-item">
        <strong>Avril 2024</strong><br /><span>Oran ‚ù§Ô∏è</span>
        <img
          src="https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80"
          class="timeline-img"
        />
      </div>
      <div id="map"></div>
    </div>

    <div id="vault-section" class="glass-card">
      <h2>üîí Zone Prot√©g√©e</h2>
      <p>Entrez la date de notre rencontre (JJMM)</p>
      <div id="pin-display">****</div>
      <div class="keypad">
        <div class="key" onclick="enterPin(1)">1</div>
        <div class="key" onclick="enterPin(2)">2</div>
        <div class="key" onclick="enterPin(3)">3</div>
        <div class="key" onclick="enterPin(4)">4</div>
        <div class="key" onclick="enterPin(5)">5</div>
        <div class="key" onclick="enterPin(6)">6</div>
        <div class="key" onclick="enterPin(7)">7</div>
        <div class="key" onclick="enterPin(8)">8</div>
        <div class="key" onclick="enterPin(9)">9</div>
        <div class="key" onclick="clearPin()">C</div>
        <div class="key" onclick="enterPin(0)">0</div>
        <div
          class="key"
          style="background: var(--primary); color: white"
          onclick="checkPin()"
        >
          OK
        </div>
      </div>
      <p id="error-msg" style="color: red; display: none; margin-top: 10px">
        Acc√®s Refus√© ! üö´
      </p>
    </div>

    <div id="locked-content">
      <div class="glass-card" style="text-align: center">
        <div class="scanner-circle">
          <div style="font-size: 2rem">‚ù§Ô∏è</div>
          <div class="scanner-line"></div>
        </div>
        <p
          id="ai-status"
          style="
            font-family: &quot;Orbitron&quot;;
            color: var(--primary);
            margin-top: 10px;
          "
        >
          Analyse...
        </p>
      </div>

      <div class="glass-card">
        <h3 style="text-align: center; color: var(--primary)">
          Nos instants vol√©s üì∏
        </h3>
        <div class="gallery">
          <div class="polaroid">
            <img
              src="https://images.unsplash.com/photo-1516589178581-6cd7833ae3b2?w=400"
              alt="Souvenir 1"
            />
          </div>
          <div class="polaroid">
            <img
              src="https://images.unsplash.com/photo-1518199266791-5375a83190b7?w=400"
              alt="Souvenir 2"
            />
          </div>
          <div class="polaroid">
            <img
              src="https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=400"
              alt="Souvenir 3"
            />
          </div>
        </div>
      </div>

      <div class="glass-card letter-section">
        <div id="typewriter"></div>
        <span class="cursor"></span>
      </div>

      <div class="glass-card">
        <h3 style="text-align: center; margin-top: 0">
          üí¨ Nos conversations...
        </h3>
        <div class="chat-container" id="chat-box"></div>
        <div class="typing" id="typing-indicator">Zoheir √©crit...</div>
      </div>

      <button class="game-trigger" onclick="openGame()">
        üéÅ LANCER LA MISSION FINALE
      </button>
    </div>

    <div id="gameModal" class="game-modal">
      <div class="game-content">
        <span class="close-game" onclick="closeGame()">&times;</span>
        <div id="quiz-section">
          <h2 id="question-text" style="color: var(--primary)">Pr√™te ?</h2>
          <div id="answers-area"></div>
          <p
            id="feedback"
            style="font-weight: bold; margin-top: 15px; height: 20px"
          ></p>
        </div>
        <div id="scratch-section" style="display: none">
          <h2
            style="
              color: var(--primary);
              font-family: &quot;Dancing Script&quot;;
            "
          >
            C'est gagn√© ! üéâ
          </h2>
          <p>Gratte pour d√©couvrir ton cadeau :</p>
          <div id="scratch-container">
            <div id="secret-prize">Bon pour un Massage ‚ù§Ô∏è</div>
            <canvas id="scratch-canvas" width="300" height="150"></canvas>
          </div>
        </div>
      </div>
    </div>

    <script>
      /* --- CONFIG --- */
      const START_DATE = new Date("2025-03-01");
      const SECRET_CODE = "2306";
      const LETTER_TEXT =
        "Ma ch√©rie,\n\nBravo, tu as craqu√© le code !\nJe voulais juste te dire √† quel point tu comptes pour moi.\nChaque moment avec toi est un tr√©sor.\n\nPr√™te pour le dernier d√©fi ?\n\n- Ton Zoheir";
      const CHAT_MSGS = [
        { s: "him", t: "Tu fais quoi ? ‚ù§Ô∏è", d: 500 },
        { s: "her", t: "Je pense √† toi...", d: 2000 },
        { s: "him", t: "Moooh c'est mignon ü•∞", d: 3500 },
        { s: "him", t: "J'ai une surprise pour toi !", d: 5000 },
      ];
      const QUIZ = [
        {
          t: "Notre premier date ?",
          a: [
            { t: "Le mexicain", c: false },
            { t: "Le voile bleu", c: false },
            { t: "Le petit chalet", c: true },
          ],
          w: "Tu as oubli√© ?! üò±",
        },
        {
          t: "Qui a toujours raison ?",
          troll: true,
          a: [
            { t: "Toi ‚ù§Ô∏è", c: true },
            { t: "Moi", c: false },
          ],
        },
      ];

      /* --- 1. COUNTER & MAP --- */
      document.getElementById("counter").innerText =
        Math.floor((new Date() - START_DATE) / (1000 * 60 * 60 * 24)) +
        " Jours";
      var map = L.map("map").setView([35.697654, -0.633737], 13);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(
        map,
      );
      L.marker([35.697654, -0.633737])
        .addTo(map)
        .bindPopup("<b>Oran</b><br>Notre QG ‚ù§Ô∏è");

      /* --- 2. VAULT --- */
      let pin = "";
      const disp = document.getElementById("pin-display");
      function enterPin(n) {
        if (pin.length < 4) {
          pin += n;
          disp.innerText = pin.padEnd(4, "*");
        }
      }
      function clearPin() {
        pin = "";
        disp.innerText = "****";
      }

      function checkPin() {
        if (pin === SECRET_CODE) {
          // 4. AUTO-PLAY MUSIQUE (AJOUT ICI)
          document.getElementById("bg-music").play();

          confetti();
          document.getElementById("vault-section").style.display = "none";
          const locked = document.getElementById("locked-content");
          locked.classList.add("visible");
          runUnlockSequence();
        } else {
          document.getElementById("error-msg").style.display = "block";
          setTimeout(
            () => (document.getElementById("error-msg").style.display = "none"),
            2000,
          );
          clearPin();
        }
      }

      /* --- 3. UNLOCK SEQUENCE --- */
      function runUnlockSequence() {
        const st = document.getElementById("ai-status");
        setTimeout(() => (st.innerText = "Scan R√©tinien..."), 1000);
        setTimeout(() => (st.innerText = "Acc√®s Autoris√© ‚úÖ"), 2500);
        setTimeout(typeWriter, 3000);
        setTimeout(startChat, 4000);
      }

      /* --- TYPEWRITER --- */
      let ti = 0;
      const tw = document.getElementById("typewriter");
      function typeWriter() {
        if (ti < LETTER_TEXT.length) {
          tw.innerHTML +=
            LETTER_TEXT.charAt(ti) === "\n" ? "<br>" : LETTER_TEXT.charAt(ti);
          ti++;
          setTimeout(typeWriter, 40);
        }
      }

      /* --- CHAT --- */
      function startChat() {
        const box = document.getElementById("chat-box");
        const typ = document.getElementById("typing-indicator");
        CHAT_MSGS.forEach((m) => {
          setTimeout(() => {
            if (m.s === "him") typ.style.display = "block";
            setTimeout(() => {
              typ.style.display = "none";
              const d = document.createElement("div");
              d.className = `msg msg-${m.s}`;
              d.innerText = m.t;
              box.appendChild(d);
              box.scrollTop = box.scrollHeight;
            }, 1000);
          }, m.d);
        });
      }

      /* --- 4. QUIZ GAME --- */
      let qIdx = 0;
      function openGame() {
        document.getElementById("gameModal").style.display = "flex";
        loadQ();
      }
      function closeGame() {
        document.getElementById("gameModal").style.display = "none";
      }

      function loadQ() {
        if (qIdx >= QUIZ.length) {
          showScratch();
          return;
        }
        const q = QUIZ[qIdx];
        document.getElementById("question-text").innerText = q.t;
        const area = document.getElementById("answers-area");
        area.innerHTML = "";
        document.getElementById("feedback").innerText = "";
        q.a.forEach((ans) => {
          const b = document.createElement("button");
          b.className = "btn-answer";
          b.innerText = ans.t;
          if (q.troll && !ans.c) {
            b.onmouseover = () => {
              b.style.position = "fixed";
              b.style.left = Math.random() * 80 + "%";
              b.style.top = Math.random() * 80 + "%";
            };
            b.ontouchstart = b.onmouseover;
          }
          b.onclick = () => {
            if (ans.c) {
              document.getElementById("feedback").innerText = "Bravo !";
              document.getElementById("feedback").style.color = "green";
              qIdx++;
              setTimeout(loadQ, 800);
            } else {
              document.getElementById("feedback").innerText = q.w;
              document.getElementById("feedback").style.color = "red";
            }
          };
          area.appendChild(b);
        });
      }

      /* --- 5. SCRATCH CARD --- */
      function showScratch() {
        document.getElementById("quiz-section").style.display = "none";
        document.getElementById("scratch-section").style.display = "block";
        document.getElementById("scratch-container").style.display = "block";
        initScratch();
        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
      }

      function initScratch() {
        const c = document.getElementById("scratch-canvas");
        const ctx = c.getContext("2d");
        ctx.fillStyle = "#b2bec3";
        ctx.fillRect(0, 0, 300, 150);
        ctx.fillStyle = "#636e72";
        ctx.font = "20px Montserrat";
        ctx.fillText("Grattez moi ‚ú®", 85, 80);
        let draw = false;
        function getPos(e) {
          var r = c.getBoundingClientRect();
          var x = (e.clientX || e.touches[0].clientX) - r.left;
          var y = (e.clientY || e.touches[0].clientY) - r.top;
          return { x, y };
        }
        function scratch(e) {
          if (!draw) return;
          e.preventDefault();
          const p = getPos(e);
          ctx.globalCompositeOperation = "destination-out";
          ctx.beginPath();
          ctx.arc(p.x, p.y, 20, 0, Math.PI * 2);
          ctx.fill();
        }
        c.addEventListener("mousedown", () => (draw = true));
        c.addEventListener("touchstart", () => (draw = true));
        c.addEventListener("mouseup", () => (draw = false));
        c.addEventListener("touchend", () => (draw = false));
        c.addEventListener("mousemove", scratch);
        c.addEventListener("touchmove", scratch);
      }

      /* --- EXTRAS --- */
      const hc = document.getElementById("heart-canvas");
      const hctx = hc.getContext("2d");
      hc.width = window.innerWidth;
      hc.height = window.innerHeight;
      let hearts = [];
      for (let i = 0; i < 30; i++)
        hearts.push({
          x: Math.random() * hc.width,
          y: Math.random() * hc.height,
          s: Math.random() * 20 + 10,
          sp: Math.random() * 2 + 1,
        });
      function drawH() {
        hctx.clearRect(0, 0, hc.width, hc.height);
        hearts.forEach((h) => {
          hctx.font = h.s + "px serif";
          hctx.fillText("‚ù§Ô∏è", h.x, h.y);
          h.y -= h.sp;
          if (h.y < -50) h.y = hc.height;
        });
        requestAnimationFrame(drawH);
      }
      drawH();

      function toggleMusic() {
        const a = document.getElementById("bg-music");
        const b = document.getElementById("music-icon");
        a.paused
          ? (a.play(), b.classList.add("music-anim"))
          : (a.pause(), b.classList.remove("music-anim"));
      }
    </script>
  </body>
</html>
